@startuml
title 缓存控制
participant "浏览器" as b
participant "代理服务器" as p
participant "服务器" as s



==缓存设定==
autonumber
b->s:发送请求
s-->b:Cache-Conntrol:no-store 禁止缓存
s-->b:Cache-Conntrol:no-cache 必须进行缓存验证,
s-->b:Cache-Conntrol:private 只允许私有缓存(浏览器缓存)


==缓存验证==
b->s:发送请求携带\n\
If-None-Match: <Etag 值>
s-->b:响应携带\n\
Etag: <Etag 值>


==Etag 缓存验证==
note over b,s
详细的 Etag 验证参见 [[https://tools.ietf.org/html/rfc7232#section-2.3 Etag]]
end note

autonumber
b->b:检测到资源不新鲜
b->s:发送请求,自动携带此标签\n\
If-None-Match:<资源的 Etag 标签> 
s->s:服务器比对传入 Etag 和当前资源 Etag 是否一致
s-->b:一致返回\n\
Status: 304 \n\
s-->b:不一致返回新资源\n\
Status: 200 \n\
Cache-Control: <设定时间>
@enduml