<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Document</title>
</head>

<body>
	<h1>cache 示例</h1>
	<div>
		<img src="/green.png" alt="gree">
		<img src="/red.png" alt="red">
	</div>
	<p><a href="/index.html">static link1</a></p>
	<p> 
		<button onclick="cache('GET')">get 请求</button> 
		<button onclick="cache('POST')">post 请求</button> 
	</p>
	<p>respond cache-control set</p>
	<ul class="respond">
		<li>
		<label for="cacheControl">
			cache-control
			<input name="cacheControl" value="max-age=100.public" type="text"></label>
		</li>
		<li><label for="withCrendential">使能  credential 模式<input name="withCrendential" type="checkbox"></label></li>
		<li><label for="customHeader">允许浏览器读取自定义请求头<input name="customHeader" type="text"></label></li>
	</ul>
	<p>request cache-control set</p>
	<ul class="request">
		<li>
		<label for="cacheControl">
				cache-control
			<input name="cacheControl" type="text"></label>
		</li>
	</ul>
	<p id="cache-get"></p>
	<script>
		function addContent(id, content) {
			let ele = document.getElementById(id);

			let str = `<p><strong>${new Date().toLocaleString()} :</strong><i>${content}</i></p>`;
			ele.innerHTML = str;
		}
		function cache(type) {
			let params = {
				cacheControl: document.querySelector('.respond input[name="cacheControl"]').value,
				withCrendential: document.querySelector('.respond input[name="withCrendential"]').checked || '',
				customHeader: document.querySelector('.respond input[name="customHeader"]').value || '',
			}
			let requestHeader = {
				'Cache-Control': document.querySelector('.request input[name="cacheControl"]').value,
			}
			let query = Object.keys(params)
             .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(params[k]))
						 .join('&');
			fetch(`http://localhost:3002/cache?${query}`, {
				body: type === 'GET'?null: JSON.stringify(params),
				method: type,
				credentials: params.withCrendential?'include':'omit',
				headers: requestHeader
			})
				.then(res => {
					console.log([...res.headers.entries()])
					return  res.json()
				})
				.then(json => {
					addContent('cache-get', json.data);
				}).catch(e => {
					addContent('cache-get',e.message)
					console.error(e)
				})
		}
	</script>
	<script src="/a.js"></script>
</body>
</html>